<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>30-Day Average FX Converter</title>
<style>
  :root { --bg:#0b1220; --card:#121a2b; --muted:#90a0b7; --text:#eaf1ff; }
  * { box-sizing: border-box; }
  body {
    margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: radial-gradient(1200px 800px at 80% -10%, #1b2440 0%, var(--bg) 40%, #090f1a 100%);
    color: var(--text); min-height: 100vh; display: grid; place-items: center; padding: 24px;
  }
  .app { width: 100%; max-width: 980px; }
  .card {
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border: 1px solid rgba(255,255,255,0.08); border-radius: 20px; padding: 22px;
    backdrop-filter: blur(8px); box-shadow: 0 20px 60px rgba(0,0,0,0.35);
  }
  h1 { font-size: clamp(20px, 2.2vw, 28px); margin: 0 0 10px; }
  p.sub { color: var(--muted); margin: 0 0 22px; }
  .row { display: grid; grid-template-columns: 1fr 1.6fr; gap: 14px; }
  .row2 { display: grid; grid-template-columns: minmax(280px,1fr) minmax(280px,1fr); gap: 14px; }
  @media (max-width: 820px){ .row{grid-template-columns:1fr;} .row2{grid-template-columns:1fr;} }

  label { font-size: 12px; color: var(--muted); display:block; margin-bottom:6px; }
  input[type="number"], select {
    width: 100%; padding: 14px 12px; font-size: 16px; border-radius: 12px;
    border: 1px solid rgba(255,255,255,0.18); background: rgba(255,255,255,0.05);
    color: var(--text); outline: none; padding-right: 1.25rem; appearance: none; -webkit-appearance: none;
    white-space: nowrap;
  }
  /* Remove number spinners */
  input[type="number"]::-webkit-outer-spin-button,
  input[type="number"]::-webkit-inner-spin-button { -webkit-appearance:none; margin:0; }
  input[type="number"] { -moz-appearance:textfield; }

  .btn {
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    padding:14px 16px; border-radius:12px; border:1px solid rgba(255,255,255,0.12);
    background: linear-gradient(180deg, rgba(122,162,255,0.25), rgba(122,162,255,0.15));
    color:white; font-weight:600; cursor:pointer;
  }
  .btn:hover{ filter:brightness(1.08); }

  .result{ margin-top:22px; padding:18px; border-radius:14px; background:rgba(155,232,216,0.08);
    border:1px solid rgba(155,232,216,0.25); }
  .result h2{ margin:0 0 6px; font-size:clamp(18px,2vw,22px); }
  .muted{ color:var(--muted); font-size:13px; }
  .grid-slim{ display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; }
</style>
</head>
<body>
  <main class="app">
    <div class="card">
      <h1>30-Day Average FX Converter</h1>
      <p class="sub">Convert between USD, CAD, GBP, AUD, EUR, and PHP using the <em>average</em> exchange rate over the last 30 days. Data from the free Frankfurter API (ECB rates).</p>

      <div class="row" style="margin-bottom:14px;">
        <div>
          <label for="amount">Amount</label>
          <input id="amount" type="number" placeholder="e.g., 125000" step="0.01" min="0" />
        </div>
        <div class="row2">
          <div>
            <label for="from">From</label>
            <select id="from">
              <option value="USD">USD — US Dollar</option>
              <option value="CAD">CAD — Canadian Dollar</option>
              <option value="GBP">GBP — British Pound</option>
              <option value="AUD" selected>AUD — Australian Dollar</option>
              <option value="EUR">EUR — Euro</option>
              <option value="PHP">PHP — Philippine Peso</option>
            </select>
          </div>
          <div>
            <label for="to">To</label>
            <select id="to">
              <option value="USD">USD — US Dollar</option>
              <option value="CAD" selected>CAD — Canadian Dollar</option>
              <option value="GBP">GBP — British Pound</option>
              <option value="AUD">AUD — Australian Dollar</option>
              <option value="EUR">EUR — Euro</option>
              <option value="PHP">PHP — Philippine Peso</option>
            </select>
          </div>
        </div>
      </div>

      <div class="actions" style="margin-bottom:10px;">
        <button id="swap" class="btn" title="Swap currencies">↔︎ Swap</button>
        <button id="convert" class="btn">Calculate with 30-Day Average</button>
      </div>

      <div id="out" class="result" style="display:none;">
        <h2 id="converted">—</h2>
        <div class="grid-slim">
          <div class="muted" id="avgline">Average rate used: —</div>
          <div class="muted" id="range">Range: —</div>
        </div>
      </div>
    </div>
  </main>

  <script>
    function formatMoney(v,c){ try{ return new Intl.NumberFormat(undefined,{style:'currency',currency:c}).format(v); }catch{ return v.toLocaleString(undefined,{maximumFractionDigits:2}); } }
    const toISO = d => d.toISOString().slice(0,10);
    const dateNDaysAgo = n => { const d = new Date(); d.setDate(d.getDate()-n); return d; };

    document.getElementById('swap').addEventListener('click', () => {
      const fromSel = document.getElementById('from'); const toSel = document.getElementById('to');
      const a = fromSel.value; fromSel.value = toSel.value; toSel.value = a;
    });

    async function fetchAverageRate(from, to, startISO, endISO){
      if(from===to) return {avg:1,count:1};
      const url = `https://api.frankfurter.app/${startISO}..${endISO}?from=${encodeURIComponent(from)}&to=${encodeURIComponent(to)}`;
      const res = await fetch(url);
      if(!res.ok) throw new Error(`Rate service error ${res.status}`);
      const data = await res.json();
      const days = Object.keys(data.rates);
      if(!days.length) throw new Error('No rate data available');
      let sum=0, count=0;
      for(const day of days){
        const r = data.rates[day][to];
        if(typeof r==='number' && isFinite(r)){ sum+=r; count++; }
      }
      return {avg: sum/count, count};
    }

    async function convert(){
      const amount = parseFloat(document.getElementById('amount').value);
      const from = document.getElementById('from').value;
      const to   = document.getElementById('to').value;
      const out = document.getElementById('out');
      const convertedEl = document.getElementById('converted');
      const avglineEl = document.getElementById('avgline');
      const rangeEl = document.getElementById('range');

      if(!isFinite(amount) || amount < 0){ return alert('Please enter a valid non-negative amount.'); }
      out.style.display='none';

      const end = new Date(), start = dateNDaysAgo(30);
      try{
        const {avg, count} = await fetchAverageRate(from,to,toISO(start),toISO(end));
        convertedEl.textContent = formatMoney(amount*avg, to);
        avglineEl.textContent = `Average rate used: 1 ${from} = ${avg.toFixed(6)} ${to} (based on ${count} trading days)`;
        rangeEl.textContent = `Range: ${toISO(start)} to ${toISO(end)}`;
        out.style.display='block';
      }catch(err){ alert('Could not fetch rates. ' + err.message); }
    }

    document.getElementById('convert').addEventListener('click', convert);
    document.getElementById('amount').addEventListener('keydown', (e)=>{ if(e.key==='Enter') convert(); });
  </script>
</body>
</html>
